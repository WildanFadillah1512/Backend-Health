// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  authId        String   @unique
  name          String
  
  // Physical data
  age           Int
  weight        Float
  height        Float
  gender        String   // "male" or "female"
  
  // Goals & Activity
  goal          String   // "lose_weight", "gain_muscle", "stay_healthy", "get_fit", "build_endurance"
  activityLevel String   // "sedentary", "lightly_active", "moderately_active", "very_active", "extremely_active"
  
  // Calculated values
  bmi           Float?
  bmr           Float?
  tdee          Float?
  targetCalories Float?
  targetWeight   Float?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  metrics       UserMetric[]
  meals         Meal[]
  workouts      UserWorkout[]
  achievements  Achievement[]
  chatSessions  ChatSession[]

  @@map("users")
}

model UserMetric {
  id          String   @id @default(cuid())
  userId      String
  date        DateTime @default(now())
  
  // Daily metrics
  weight      Float
  bmi         Float
  steps       Int      @default(0)
  waterIntake Int      @default(0) // in ml
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, date])
  @@map("user_metrics")
}

model Food {
  id           String  @id @default(cuid())
  name         String
  calories     Float
  
  // Macros (per serving)
  protein      Float
  carbs        Float
  fats         Float
  
  servingSize  String  // e.g., "100g", "1 cup"
  category     String  // "breakfast", "lunch", "dinner", "snack"
  healthScore  Int     @default(5) // 1-10 scale
  imageUrl     String?
  
  createdAt    DateTime @default(now())
  
  @@index([name])
  @@map("foods")
}

model Meal {
  id           String   @id @default(cuid())
  userId       String
  date         DateTime @default(now())
  mealType     String   // "breakfast", "lunch", "dinner", "snack"
  
  // Food items stored as JSON array
  // Example: [{"foodId": "1", "name": "Nasi Goreng", "calories": 400, "protein": 12, "carbs": 60, "fats": 10, "portion": 1.5}]
  foodItems    String   @default("[]")
  
  totalCalories Float
  totalProtein  Float
  totalCarbs    Float
  totalFats     Float
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, date])
  @@map("meals")
}

model Workout {
  id              String  @id @default(cuid())
  name            String
  description     String?
  duration        Int     // in minutes
  difficulty      String  // "beginner", "intermediate", "advanced"
  
  // Body parts targeted
  bodyPart        String  // "arms", "chest", "abs", "legs", "back", "full_body"
  
  // Calories burned estimation (per session)
  caloriesBurned  Int
  
  // Exercise instructions stored as JSON array
  // Example: [{"name": "Push-ups", "sets": 3, "reps": 15, "duration": 60}]
  exercises       String  @default("[]")
  
  videoUrl        String?
  thumbnailUrl    String?
  
  createdAt       DateTime @default(now())
  
  // Relations
  userWorkouts    UserWorkout[]
  
  @@index([bodyPart, difficulty])
  @@map("workouts")
}

model UserWorkout {
  id              String   @id @default(cuid())
  userId          String
  workoutId       String
  date            DateTime @default(now())
  
  // Actual completion data
  completionTime  Int      // in minutes
  caloriesBurned  Int
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout         Workout  @relation(fields: [workoutId], references: [id])
  
  @@index([userId, date])
  @@map("user_workouts")
}

model Achievement {
  id              String   @id @default(cuid())
  userId          String
  achievementType String   // "first_workout", "7_day_streak", "weight_goal", etc.
  title           String
  description     String
  iconUrl         String?
  unlockedAt      DateTime @default(now())
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@map("achievements")
}

model ChatSession {
  id        String   @id @default(cuid())
  userId    String
  title     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages ChatMessage[]

  @@index([userId])
  @@map("chat_sessions")
}

model ChatMessage {
  id        String   @id @default(cuid())
  sessionId String
  role      String   // "user" or "assistant"
  content   String
  createdAt DateTime @default(now())

  session ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("chat_messages")
}

